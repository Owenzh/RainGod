{% extends "admin/bases.html" %}
<!-- {% import "admin/fy.html" as pg %} -->
{% block content %}
<script type="text/javascript" src="{{url_for('static',filename='js/lib/layui/layui.js',tsc=tscv)}}"></script>

<div class="x-body">
  <div class="layui-row">
    <!-- <p>小区信息管理页面</p> -->
    <table class="layui-hide" id="test" lay-filter="test">

    </table>
     <table class="layui-table" lay-data="{height:620, data:{{jsonData}},toolbar: 'default',page:true, id:'test'}" lay-filter="test">
      <thead>
        <tr>
            <th lay-data="{type:'checkbox'}">ID</th>
          <th lay-data="{field:'id', width:150, sort: true}">小区编号</th>
          <th lay-data="{field:'name', width:400,sort: true}">小区名称</th>
          <th lay-data="{field:'mgeaddr', sort: true}">管理员</th>
        </tr>
      </thead>
    </table>
    <script type="text/html" id="toolbarDemo">
      <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="getCheckData">获取选中行数据</button>
        <button class="layui-btn layui-btn-sm" lay-event="getCheckLength">获取选中数目</button>
        <button class="layui-btn layui-btn-sm" lay-event="isAll">验证是否全选</button>
      </div>
    </script>
     
    <script type="text/html" id="barDemo">
      <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
      <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    </script>

  </div>
<div>

 <script>
      console.log($('#testdata').val());
layui.use('table', function(){
  var table = layui.table;
  table.on('toolbar(test)', function(obj){
    var checkStatus = table.checkStatus(obj.config.id)
    ,data = checkStatus.data; //获取选中的数据
    switch(obj.event){
      case 'add':
        //layer.msg('添加');
        layer.open({
            title: '小区维护',
            type: 2,
            skin: 'layui-layer-rim', //加上边框
            area: ['500px', '300px'], //宽高
            content: ['/admin/subdistrictmgr_change','no'], //弹出的页面
            shadeClose: true, //点击遮罩关闭
        });
      break;
      case 'update':
        if(data.length === 0){
          layer.msg('请选择一行');
        } else if(data.length > 1){
          layer.msg('只能同时编辑一个');
        } else {
          layer.alert('编辑 [id]：'+ checkStatus.data[0].id);
        }
      break;
      case 'delete':
        if(data.length != 1){
          layer.msg('请选择一行');
        } else {
          layer.confirm('真的删除行么', function(index){
          layer.close(index);
          $.ajax({
              type : "get",   
              url : "/admin/subdistrictmgr_delete/"+checkStatus.data[0].id,//请求的 URL地址
              dataType : "json",
              success: function (data) {
                if(data.status==="OK"){
                  layer.msg('删除成功');
                  window.location.reload(); 
                }else{
                  layer.msg(data.status);
                }
              },
              error:function (data) {
                  layer.msg('删除失败');
              }
          });
          });    
        }
      break;
    };
  });
  
  //监听行工具事件
  table.on('tool(test)', function(obj){ //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
    var data = obj.data //获得当前行数据
    ,layEvent = obj.event; //获得 lay-event 对应的值
    if(layEvent === 'detail'){
      layer.msg('查看操作');
    } else if(layEvent === 'del'){
      layer.confirm('真的删除行么', function(index){
        obj.del(); //删除对应行（tr）的DOM结构
        layer.close(index);
        $.ajax({  
        type:'get',
        url:urlStr,
        data:serialStr,  
        success:function(code){  
            if  (code ==0) {  
                layer.msg('添加成功!',{icon:1,time:1000});
            }else{  
                layer.msg('添加失败!',{icon:2,time:1000});
            }
        }
    });
      });
    } else if(layEvent === 'edit'){
      layer.msg('编辑操作');
    }
  });
});
        </script>
</div>

</div>

{% endblock %}